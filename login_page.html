<!DOCTYPE html>
<html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<head>
    <script>
        function login() {
            var transdata = {
                'username': document.getElementById("login_username").value,
                'password': document.getElementById("login_password").value
            };

            //temp is a temporary value of feedback
            fetch("nss.php?do=login", {
                    method: 'post',
                    body: JSON.stringify(transdata),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(res => {
                    return res.json();
                })
                .then(feedback => {
                    if (feedback.token == '0') {
                        alert("Wrong username or password")
                        window.location.href = "login_page.html";
                        return "Login Fail";
                    }

                    //Get the time and set for 2 hours access
                    var date = new Date();
                    date.setTime(date.getTime() + (2 * 60 * 60 * 1000));

                    //Get token

                    var token = feedback.token;

                    //Set cookie
                    document.cookie = "Token=" + token + "; expires=" + date.toGMTString();

                    return "Login Success";
                });
        }
    </script>
</head>

<body>
    <div id="login_info">
        Username:<br>
        <input type="text" name="username" value="" id="login_username">
        <br> Password:<br>
        <input type="password" name="password" value="" id="login_password">
        <br><br>
        <button onclick="login()">登录</button>
    </div>
</body>

</html>
